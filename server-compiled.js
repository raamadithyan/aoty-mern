(()=>{var e={860:e=>{"use strict";e.exports=require("express")},13:e=>{"use strict";e.exports=require("mongodb")},109:e=>{"use strict";e.exports=require("sanitize-html")},37:e=>{"use strict";e.exports=require("os")}},t={};function a(s){var o=t[s];if(void 0!==o)return o.exports;var i=t[s]={exports:{}};return e[s](i,i.exports,a),i.exports}(()=>{const e=a(860),{MongoClient:t,ObjectId:s}=(a(37),a(13)),o=a(109),i=e();let r;i.set("view engine","ejs"),i.set("views","./view"),i.use(e.static("public")),i.use(e.json()),i.use(e.urlencoded({extended:"false"})),i.get("/",(async(e,t)=>{const a=await r.collection("animals").find().toArray();t.render("home",{query:a})})),i.use((function(e,t,a){t.set("WWW-Authenticate","Basic realm='AOTY'"),"Basic YWRtaW46YWRtaW4="===e.headers.authorization?a():(console.log(e.headers.authorization),t.status(401).send("Try Again"))})),i.get("/admin",((e,t)=>{t.render("admin")})),i.get("/api/topalbums",(async(e,t)=>{const a=await r.collection("topalbums").find().toArray();t.json(a)})),i.post("/addalbum",(function(e,t,a){"string"!=typeof e.body.album&&(e.body.album=""),"string"!=typeof e.body.artist&&(e.body.artist=""),"string"!=typeof e.body.year&&(e.body.year=""),"string"!=typeof e.body.imageurl&&(e.body.imageurl=""),"string"!=typeof e.body._id&&(e.body._id=""),e.cleanData={album:o(e.body.album.trim(),{allowedTags:[],allowedAttributes:{}}),artist:o(e.body.artist.trim(),{allowedTags:[],allowedAttributes:{}}),year:o(e.body.year.trim(),{allowedTags:[],allowedAttributes:{}}),imageurl:o(e.body.imageurl.trim(),{allowedTags:[],allowedAttributes:{}})},a()}),(async(e,t)=>{console.log(e.body);const a=await r.collection("topalbums").insertOne(e.cleanData),o=await r.collection("topalbums").findOne({_id:new s(a.insertedId)});t.send(o)})),i.delete("/addalbum/:id",(async(e,t)=>{"string"!=typeof e.params.id&&(e.params.id=""),r.collection("topalbums").deleteOne({_id:new s(e.params.id)}),t.send("deleted")})),async function(){const e=new t("mongodb+srv://raamadithyan:raamadithyan@cluster0.r8sszts.mongodb.net/AmazingMernApp?retryWrites=true&w=majority");await e.connect(),r=e.db(),i.listen(3e3)}()})()})();